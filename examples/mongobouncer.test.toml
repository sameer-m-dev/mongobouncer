# Minimal MongoBouncer Configuration for Testing
# This is the absolute minimum configuration needed to run MongoBouncer

[mongobouncer]
listen_addr = "0.0.0.0"
listen_port = 27017
log_level = "info"

# Connection management
pool_mode = "statement"
max_client_conn = 0

# MongoDB client pool settings (defaults for all databases)
max_pool_size = 20                    # MongoDB driver's internal pool size
min_pool_size = 3                     # MongoDB driver's minimum pool size
max_conn_idle_time = "30s"            # How long to keep idle connections
server_selection_timeout = "5s"        # Server selection timeout
connect_timeout = "5s"                # Connection establishment timeout
socket_timeout = "30s"                # Socket operation timeout
heartbeat_interval = "10s"            # Heartbeat frequency

# Prometheus metrics (optional but recommended)
metrics_address = "0.0.0.0:9090"
metrics_enabled = true

# Database connections - Configure these for your MongoDB setup
[databases]
# Application databases - wildcard route for all databases
"*" = { connection_string = "mongodb://localhost:27019" }
# Specific database routes
mongobouncer_test = { connection_string = "mongodb://localhost:27019/mongobouncer_test" }

[databases.pool_test]
connection_string = "mongodb://localhost:27018/pool_test"
max_pool_size = 10                   
min_pool_size = 10                   
socket_timeout = "60s"

# Database-specific MongoDB client overrides (optional)
[databases.high_traffic_db]
connection_string = "mongodb://localhost:27019/high_traffic_db"
max_pool_size = 50                    # Override default for high-traffic database
min_pool_size = 10                    # Override default
socket_timeout = "60s"                # Longer timeout for this DB

[databases.analytics_db]
connection_string = "mongodb://localhost:27019/analytics_db"
max_pool_size = 5                     # Smaller pool for analytics
heartbeat_interval = "30s"            # Less frequent heartbeats

# Alternative: More explicit configuration
# [databases.test_db]
# host = "localhost"
# port = 27017
# database = "test"
# max_connections = 20

# Optional: Basic user authentication
# [users]
# [users.test_user]
# password = "test_password"
# max_user_connections = 10
